spring.application.name=auth-service
# ========================================================
# Application Info
# ========================================================

server.port=8081


# ========================================================
# R2DBC PostgreSQL Configuration
# ========================================================
spring.r2dbc.url=r2dbc:postgresql://localhost:5432/eduhub_auth
spring.r2dbc.username=postgres
spring.r2dbc.password=secure_password
spring.r2dbc.pool.enabled=true
spring.r2dbc.pool.initial-size=10
spring.r2dbc.pool.max-size=50
spring.r2dbc.pool.max-idle-time=30m

# JDBC for Flyway (Flyway does not support R2DBC)
spring.flyway.enabled=true
spring.flyway.url=jdbc:postgresql://localhost:5432/eduhub_auth
spring.flyway.user=postgres
spring.flyway.password=secure_password
spring.flyway.locations=classpath:db/migration

# ========================================================
# Redis Configuration
# ========================================================
# Redis core connection settings
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=your_password
spring.data.redis.timeout=10s

# Lettuce pool settings
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5



# ========================================================
# Kafka Configuration
# ========================================================
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.batch-size=16384
spring.kafka.producer.buffer-memory=33554432
spring.kafka.template.default-topic=${kafka.topics.user-created}
kafka.topics.user-created=user.created

# ========================================================
# JWT Configuration
# ========================================================
jwt.secret=${JWT_SECRET:your-strong-256-bit-base64-secret}
jwt.expiration=3600000            # 1 hour (in milliseconds)
jwt.refresh.expiration=604800000  # 7 days (in milliseconds)

# ========================================================
# OAuth2 Client Configuration (Spring Boot Standard)
# ========================================================
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:your-google-client-id}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:your-google-client-secret}
spring.security.oauth2.client.registration.google.redirect-uri=http://localhost:8081/login/oauth2/code/google

spring.security.oauth2.client.registration.github.client-id=${GITHUB_CLIENT_ID:your-github-client-id}
spring.security.oauth2.client.registration.github.client-secret=${GITHUB_CLIENT_SECRET:your-github-client-secret}
spring.security.oauth2.client.registration.github.redirect-uri=http://localhost:8081/login/oauth2/code/github

# ========================================================
# Resilience4j Retry Configuration
# ========================================================
resilience4j.retry.instances.kafka-retry.max-attempts=3
resilience4j.retry.instances.kafka-retry.wait-duration=1s
resilience4j.retry.instances.kafka-retry.enableExponentialBackoff=true
resilience4j.retry.instances.kafka-retry.exponentialBackoffMultiplier=2
resilience4j.retry.instances.kafka-retry.maxWaitDuration=10s

# Optional: limit retry only for custom exception
# resilience4j.retry.instances.kafka-retry.retry-exceptions=com.eduhub.auth_service.exception.EventPublishingException
# resilience4j.retry.instances.kafka-retry.ignore-exceptions=java.lang.IllegalArgumentException

# ========================================================
# Logging Configuration
# ========================================================
logging.level.root=INFO
logging.level.com.eduhub.auth_service=DEBUG
logging.level.org.springframework.security=DEBUG

logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/auth-service.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=7

# ========================================================
# Actuator + Prometheus Monitoring
# ========================================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.metrics.tags.application=${spring.application.name}
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.sla.http.server.requests=100ms,200ms,500ms

# ========================================================
# Jackson / Validation Configuration
# ========================================================


# ========================================================
# Rate Limiting (Gateway Placeholder Only)
# ========================================================
# spring.cloud.gateway.routes[0].filters[0]=RequestRateLimiter=10,10,redis-rate-limiter
